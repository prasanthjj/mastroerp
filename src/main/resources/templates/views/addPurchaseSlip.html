<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Mastro Metals | Add Sales Slip</title>

    <link href="../resources/css/bootstrap.min.css" rel="stylesheet" th:src="@{/resources/css/bootstrap.min.css}">
    <link href="../resources/font-awesome/css/font-awesome.css" rel="stylesheet"
          th:src="@{/resources/font-awesome/css/font-awesome.css}">
    <!-- Sweet Alert -->
    <link href="../resources/css/plugins/sweetalert/sweetalert.css" rel="stylesheet"
          th:src="@{/resources/css/plugins/sweetalert/sweetalert.css}">
    <!-- Morris -->
    <link href="../resources/css/plugins/morris/morris-0.4.3.min.css" rel="stylesheet"
          th:src="@{/resources/css/plugins/morris/morris-0.4.3.min.css}">
    <link href="../resources/css/animate.css" rel="stylesheet" th:src="@{/resources/css/animate.css}">
    <link href="../resources/css/style.css" rel="stylesheet" th:src="@{/resources/css/style.css}">
    <link href="../resources/css/mastro-style.css" rel="stylesheet" th:src="@{/resources/css/mastro-style.css}">
</head>

<body>
<div id="wrapper">
    <nav lang="en" th:replace="views/fragments/sidepanel :: nav"></nav>


    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom ">
            <nav lang="en" th:replace="views/fragments/header :: nav"></nav>
        </div>

        <div class="row wrapper border-bottom white-bg page-heading">
            <div class="col-lg-7">
                <h2 class="text-info"><i class="fa fa-barcode"></i> Add Sales Slip</h2>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="#">Inventory</a>
                    </li>
                    <li class="breadcrumb-item active">
                        <a href="#">DC / Sales List</a>
                    </li>
                    <li class="breadcrumb-item active">
                        <strong> Add Sales Slip</strong>
                    </li>
                </ol>
            </div>
            <div lang="en" th:replace="views/fragments/ipaddress :: div"></div>
        </div>
        <div class="wrapper wrapper-content">

            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox ">
                        <div class="ibox-content mastro-step-inbox-content">
                            <form th:action="@{/inventory/createSalesSlipBasic}"
                                  th:object="${salesSlipForm}"
                                  name="salesSlipForm" method="post">
                                <span th:if="${salesSlipDetails== null}">
                                <div class="row">
                                    <div class="col-lg-4">
                                        <div class="form-group"><label>Party Name</label>
                                            <input type="hidden" name="selectedPartyInSalesSlip" id="partyIdSalesInput">
                                            <input type="text" class="form-control salespartyautocomplete"
                                                   placeholder="Select party"
                                                   required>
                                            <i class="icon-triangle-down"></i>
                                            <div class="party_sales_dropdown">
                                                <ul class="auto-dropdown-menu">

                                                </ul>
                                            </div>
                                        </div>

                                        <div class="form-group"><label>Category</label>
                                            <h4>
                                                <span id="category"></span>
                                            </h4>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-bordered ">
                                                <tr>
                                                    <td class="master-blue-bg txt-white" width="50%">Transport Mode</td>
                                                    <td>
                                                        <input type="text" class="form-control" name="transportMode"/>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="master-blue-bg txt-white">vehicle No</td>
                                                    <td>
                                                        <input type="text" class="form-control" name="vehicleNo"/>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="form-group text-right">
                                            <button class="btn btn-primary" type="submit">Select</button>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group"><label>Delivery Address</label>
                                            <p> <strong id="delivarycontactperson"></strong><br>
                                                <span id="delivarydesignation"></span><br>
                                                <span id="delivaryaddress"></span><br>
                                                <span>Phone no : <span id="deliveryphoneno"></span></span><br>
                                                <span>Email ID : <span id="deliveryemail"></span></span>
                                            </p>
                                        </div>
                                    </div>

                                    <div class="col-lg-4">
                                        <div class="form-group">

           <div><label>Billing Address</label>
                  <p> <strong id="partycontactperson"></strong><br>
        <span id="city"></span><br>
     <span id="state"></span> ,
    <span id="country"></span><br>
        <span>Pincode : <span id="pincode"></span></span><br>
        <span>Phone no : <span id="phoneno"></span></span><br>
        <span>Email ID : <span id="email"></span></span>
    </p>
</div>

                                        </div>
                                    </div>

                                </div>
                                </span>
                                <span th:unless="${salesSlipDetails== null}">
                                <div class="row">
                                    <div class="col-lg-4">
                                        <div class="form-group"><label>Party Name</label>

                                         <h4>
                                               <span th:text="${salesSlipDetails.party.partyName}"></span>
                                         </h4>
                                        </div>

                                        <div class="form-group"><label>Category</label>
                                            <h4>
                                                <span th:text="${salesSlipDetails.party.categoryType}"></span>
                                            </h4>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-bordered ">
                                                <tr>
                                                    <td class="master-blue-bg txt-white" width="50%">Transport Mode</td>
                                                    <td>
                                                        <span class="form-control"
                                                              th:text="${salesSlipDetails.transportMode}"></span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="master-blue-bg txt-white">vehicle No</td>
                                                    <td>
                                                       <span class="form-control"
                                                             th:text="${salesSlipDetails.vehicleNo}"></span>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                        <!-- <div class="form-group text-right">
                                             <button class="btn btn-primary" type="submit">Select</button>
                                         </div>-->
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group"><label>Delivery Address</label>
                                            <p> <strong th:text="${contactDetails.contactPersonName}"></strong><br>
                                                <span th:text="${contactDetails.designation}"></span><br>
                                                <span th:text="${contactDetails.address}"></span><br>
                                                <span>Phone no : <span
                                                        th:text="${contactDetails.mobileNo}"></span></span><br>
                                                <span>Email ID : <span
                                                        th:text="${contactDetails.emailId}"></span></span>
                                            </p>
                                        </div>
                                    </div>

                                    <div class="col-lg-4">
                                        <div class="form-group">

                                            <div><label>Billing Address</label>
                                                <p> <strong th:text="${billingDetails.contactPersonName}"></strong><br>
                                                    <span th:text="${billingDetails.city}"></span><br>
                                                    <span th:text="${billingDetails.state}"></span> ,
                                                    <span th:text="${billingDetails.country}"></span><br>
                                                    <span>Pincode : <span
                                                            th:text="${billingDetails.pinCode}"></span></span><br>
                                                    <span>Phone no : <span
                                                            th:text="${billingDetails.telephoneNo}"></span></span><br>
                                                    <span>Email ID : <span
                                                            th:text="${billingDetails.emailId}"></span></span>
                                                </p>
                                            </div>

                                        </div>
                                    </div>

                                </div>
                        </span>
                            </form>
                            <div class="ibox">
                                <div class="ibox-title  ">
                                    <h3>Item Particulars</h3>
                                    <div class="ibox-tools">

                                    </div>
                                </div>
                                <div class="ibox-content">
                                    <div class="row">
                                        <div class="col-lg-4">
                                            <div class="form-group"><label>Item Name</label>

                                                    <!--<input type="text" class="form-control item_head"
                                                          >-->
                                                    <span th:if="${salesSlipDetails!= null}">
                                                       <input type="hidden" th:value="${salesSlipDetails.id}"
                                                              id="salesslipid">
                                                   <input type="hidden" name="selectedPartysId"
                                                          th:value="${salesSlipDetails.party.id}" id="partssalesid">
                                                   </span>
                                                    <input type="hidden" name="selectedProduct" id="itemIdInputSale">
                                                    <input type="text" class="form-control itemautocmopleteinsalesslip"
                                                           placeholder="Select item">

                                                    <div class="item_dropdown_sales">
                                                        <ul class="auto-dropdown-menu">

                                                        </ul>
                                                    </div>



                                            </div>

                                        </div>

                                        <div class="col-lg-2">
                                            <div class="form-group"><label>UOM</label>
                                                <select class="form-control" id="saleuom" required>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-2">
                                            <div class="form-group"><label>Quantity</label>
                                                <input type="text" class="form-control" id="qtyenter"/>
                                            </div>
                                        </div>

                                        <div class="col-lg-2">
                                            <div class="form-group"><label>Rate</label>
                                                <input type="text" class="form-control" id="rate" readonly/>
                                            </div>
                                        </div>
                                        <div class="col-lg-2 m-t-lg">
                                            <a href="#" class="right-sidebar-toggle btn btn-primary  txt-white addItemButton">Add
                                                Item
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-bordered  ">
                                    <thead class="mastro-blue-bg ">
                                    <tr class="mastro-blue-bg txt-white">
                                        <th class="mastro-blue-bg ">No</th>
                                        <th class="mastro-blue-bg txt-white">Item</th>
                                        <th class="mastro-blue-bg txt-white">HSN / SAC</th>
                                        <th class="mastro-blue-bg txt-white">Quantity</th>
                                        <th class="mastro-blue-bg txt-white">Net Price</th>
                                        <th class="mastro-blue-bg txt-white">Taxable Value</th>
                                        <th class="mastro-blue-bg txt-white">CGST</th>
                                        <th class="mastro-blue-bg txt-white">SGST</th>
                                        <th class="mastro-blue-bg txt-white">Total</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <span th:if="${salesSlipDetails!= null}">
                                    <tr th:each="salesslipItemObj,iterator:${salesSlipDetails.salesSlipItemsSet}">
                                        <td th:text="${iterator.index+1}">1</td>
                                        <td th:text="${salesslipItemObj.product.productName}">Oxy .47 Red 3.05mtr (10')</td>
                                        <td th:text="${salesslipItemObj.hsnCode}">HSN-0265</td>
                                        <td><span th:text="${salesslipItemObj.grnQty}"></span> <span
                                                th:text="${salesslipItemObj.productUOM.uom.UOM}"></span></td>
                                        <td><span
                                                th:text="${#numbers.formatDecimal(salesslipItemObj.netPrice, 0, 'COMMA', 4, 'POINT')}"></span>/<span
                                                th:text="${salesslipItemObj.productUOM.uom.UOM}"></span></td>

                                        <td th:text="${#numbers.formatDecimal(salesslipItemObj.totalAmount, 0, 'COMMA', 4, 'POINT')}">3500</td>
                                        <td th:text="${#numbers.formatDecimal(salesslipItemObj.cgstAmount, 0, 'COMMA', 4, 'POINT')}">350</td>
                                        <td th:text="${#numbers.formatDecimal(salesslipItemObj.sgstAmount, 0, 'COMMA', 4, 'POINT')}">175</td>
                                        <td th:text="${#numbers.formatDecimal(salesslipItemObj.finalAmount, 0, 'COMMA', 4, 'POINT')}"></td>
                                    </tr>
                                             <tr rowspan="3">
                                                <td colspan="10"></td>
                                            </tr>
                                         <tr>
                                        <td></td>
                                        <td></td>
                                        <td>Sub Total</td>
                                        <td colspan="5"></td>
                                        <td th:if="${subTotal!= null}"><span
                                                th:text="${#numbers.formatDecimal(subTotal, 0, 'COMMA', 4, 'POINT')}"></span></td>
                                    </tr>
                                         <tr>
                                        <td></td>
                                        <td th:if="${loadingHSN!= null}"><span
                                                th:text="${loadingHSN.hsnCode}">7314</span></td>
                                        <td th:if="${loadingHSN!= null}">Loading Charges@<span
                                                th:text="${loadingHSN.igst}">18</span> %(Sales)</td>
                                        <td></td>
                                        <td></td>
                                        <td th:if="${loadingChargeSum!= null}"> <span
                                                th:text="${#numbers.formatDecimal(loadingChargeSum, 0, 'COMMA', 4, 'POINT')}"></span></td>
                                        <td th:if="${loadingChargeSgstAmt!= null}"><span
                                                th:text="${#numbers.formatDecimal(loadingChargeSgstAmt, 0, 'COMMA', 4, 'POINT')}"></span></td>
                                        <td th:if="${loadingChargeCgstAmt!= null}"><span
                                                th:text="${#numbers.formatDecimal(loadingChargeCgstAmt, 0, 'COMMA', 4, 'POINT')}"></span></td>
                                        <td th:if="${finalLoadingCharge!= null}"><span
                                                th:text="${#numbers.formatDecimal(finalLoadingCharge, 0, 'COMMA', 4, 'POINT')}"></span></td>


                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td>Kerala Flood Cess</td>
                                        <td></td>
                                         <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td th:if="${cessTotal!= null}"> <span
                                                th:text="${#numbers.formatDecimal(cessTotal, 0, 'COMMA', 4, 'POINT')}">7.1586</span></td>


                                    </tr>

                                    </span>
                                    </tbody>
                                    <tfoot>

                                    </tfoot>
                                </table>
                            </div>
                            <span th:if="${salesSlipDetails!= null}">
                            <form th:action="@{/inventory/saveSalesSlipFullDetails}"
                                  th:object="${salesSlipForm}"
                                  name="salesSlipForm" method="post">
                                <input type="hidden" name="id" th:value="${salesSlipDetails.id}">
                                <span th:if="${grandTotal!= null}">
                                 <input type="hidden" name="totalLoadingCharge" th:value="${finalLoadingCharge}">
                                <input type="hidden" name="totalCess" th:value="${cessTotal}">
                                <input type="hidden" name="subTotal" th:value="${subTotal}">
                                <input type="hidden" name="totalTaxableValue" th:value="${totalTaxableValue}">
                                <input type="hidden" name="totalCgst" th:value="${totalCgst}">
                                <input type="hidden" name="totalSgst" th:value="${totalSgst}">
                                <input type="hidden" name="totalAmt" th:value="${totalAmt}">
                                <input type="hidden" name="grandTotal" th:value="${grandTotal}">
                                <input type="hidden" name="roundOff" th:value="${roundOff}">
                                    <input type="hidden" name="loadingChargeSum" th:value="${loadingChargeSum}">
                                <input type="hidden" name="loadingChargeCgst" th:value="${loadingChargeCgstAmt}">
                                <input type="hidden" name="loadingChargesgst" th:value="${loadingChargeSgstAmt}">
                                    </span>
                            <div class="row m-t-md">
                                <div class="col-lg-12 text-right">
                                       <h3 class="" th:if="${totalAmt!= null}"> Round Off :
                                            <span th:text="${#numbers.formatDecimal(totalAmt, 0, 'COMMA', 4, 'POINT')}"> 850.0000</span></h3>
                                    <h3 class="" th:if="${roundOff!= null}"> Round Off :
                                            <span th:text="${roundOff}"> 850.0000</span></h3>
                                        <h3 class="" th:if="${grandTotal!= null}">Grand Total :<span
                                                th:text="${grandTotal}"></span>
                                        </h3>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group"><label>Special instructions</label>
                                        <textarea class="form-control" rows="6" name="specificInst">
        
                                            </textarea>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group"><label>Remarks</label>
                                        <textarea class="form-control" rows="6" name="remarks">

                                    </textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12 text-right">
                                <button class="btn btn-primary btn-sm grn" type="submit">Create Purchase Slip</button>
                            </div>
                            </form>
                            </span>
                        </div>
                    </div>
                </div>
            </div>


        </div>


        <footer lang="en" th:replace="views/fragments/footer :: footer"></footer>

    </div>
    <div id="right-sidebar" class="animated">
        <div class="sidebar-container">


            <div class="tab-content">


                <div id="tab-1" class="tab-pane active">

                    <!--  <div class="sidebar-title">
                          <h3><i class="fa fa-barcode"></i> <span id="grnProductId"></span></h3>

                      </div>-->

                    <div>

                        <div class="sidebar-message">
                            <div class="table-responsive">
                                <table class="table table-bordered " id="grnitemDetails">
                                    <thead>
                                    <tr class="mastro-blue-bg txt-white">
                                        <th>GRN No</th>
                                        <th>Product Name</th>
                                        <th>Quantity</th>
                                        <th></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <!--  <tr>
                                          <td>GRN0246875</td>
                                          <td>24</td>
                                          <td><a href="#" class="btn btn-primary">Select</a></td>
                                      </tr>-->
                                    </tbody>

                                </table>
                            </div>

                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>

<!-- Mainly scripts -->
<div lang="en" th:replace="views/fragments/switchBranch :: div"></div>
<span id="partyAutopopulateInSalesSlipUrl" th:data-url="@{/autopopulate/party/customer}"></span>
<span id="productAutopopulateInSalesSlipUrl" th:data-url="@{/autopopulate/items/salesslip}"></span>
<script src="../resources/js/jquery-3.1.1.min.js" th:src="@{/resources/js/jquery-3.1.1.min.js}"></script>
<script src="../resources/js/popper.min.js" th:src="@{/resources/js/popper.min.js}"></script>
<script src="../resources/js/bootstrap.js" th:src="@{/resources/js/bootstrap.js}"></script>
<script src="../resources/js/plugins/metisMenu/jquery.metisMenu.js"
        th:src="@{/resources/js/plugins/metisMenu/jquery.metisMenu.js}"></script>
<script src="../resources/js/plugins/slimscroll/jquery.slimscroll.min.js"
        th:src="@{/resources/js/plugins/slimscroll/jquery.slimscroll.min.js}"></script>
<script src="../resources/js/plugins/validate/jquery.validate.min.js"
        th:src="@{/resources/js/plugins/validate/jquery.validate.min.js}"></script>
<!-- Custom and plugin javascript -->
<script src="../resources/js/inspinia.js" th:src="@{/resources/js/inspinia.js}"></script>
<script src="../resources/js/mastro/mastro_main.js" th:src="@{/resources/js/mastro/mastro_main.js}"></script>
<script src="../resources/js/plugins/pace/pace.min.js" th:src="@{/resources/js/plugins/pace/pace.min.js}"></script>
<!-- jQuery UI -->
<script src="../resources/js/plugins/jquery-ui/jquery-ui.min.js"
        th:src="@{/resources/js/plugins/jquery-ui/jquery-ui.min.js}"></script>


<!-- Sweet alert -->
<script src="../resources/js/plugins/sweetalert/sweetalert.min.js"
        th:src="@{/resources/js/plugins/sweetalert/sweetalert.min.js}"></script>
<script>
      $(document).ready(function(){


       var itemAutopopulateUrlInSales = $('#productAutopopulateInSalesSlipUrl').data('url');
     $(".item_dropdown_sales").hide();
     $(".itemautocmopleteinsalesslip").keyup(function () {

		var val = $(this).val().trim();
		if (val.length > 2) {
		var partsSalesId=document.getElementById("partssalesid").value;
		$(".item_dropdown_sales ul").empty();
		     $.ajax({
              url:itemAutopopulateUrlInSales,
               type: 'GET',
               dataType : 'json',
               data: {'searchTerm':val,'partyId':partsSalesId},
               success: function(data){
                 if(data.success) {
                        $.each(data.data.products, function(i){
                                      $(".item_dropdown_sales ul").append('<li><a class="dynamicClick" data-itemsidsales="'+this['id'] +'" href="#">'+ this['productname'] +'</a></li>');
                                        });
                  }
                   },
               error: function(jqXHR, textStatus) {
               alert('Error Occured');
               }

              });
              $(".item_dropdown_sales").show();
		}
		else {
        			$(".item_dropdown_sales").hide();
        		}
		});


	$(".item_dropdown_sales").on('click','a.dynamicClick',function (e) {
        		e.preventDefault();
        		var value = $(this).text();
        		var productIdSale = $(this).data('itemsidsales');
        		var partysSalesIds=document.getElementById("partssalesid").value;
                $(".itemautocmopleteinsalesslip").val(value);
                $("#itemIdInputSale").val($(e.target).data('itemsidsales'));
        		$(".item_dropdown_sales").hide();
        		 $.ajax({
                                                                  url: '/inventory/getProductDetailsInSales',
                                                                                type: 'GET',
                                                                                dataType : 'json',
                                                                                data: { 'partyIdSale': partysSalesIds,'productIdSale': productIdSale},
                                                                                success: function(data){
                                                                                    if(data.success) {
                                                                                  $("#saleuom").html("");
                                                                                  $('#rate').val(data.data.rate);
                                                                                    $.each(data.data.salesuoms, function(i){
                                                              $('#saleuom').append($('<option>').val(this['id']).text(this['nameuom']));
                                                               });
                                                                                    }
                                                                                },
                                                                                error: function(jqXHR, textStatus) {
                                                                                    alert('Error Occured');
                                                                                }
                                                                            });

        	})

      });



</script>

</body>
</html>
